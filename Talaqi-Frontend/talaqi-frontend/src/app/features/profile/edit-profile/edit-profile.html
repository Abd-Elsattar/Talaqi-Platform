<!-- Edit Profile template: form for updating user information. -->
<div class="edit-profile-page">
  <!-- Hero Section with Blue Bottom Border -->
  <div class="hero-section">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">{{ 'editProfile.hero.title' | translate }}</h1>
        <p class="hero-subtitle">{{ 'editProfile.hero.subtitle' | translate }}</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <!-- Loading State -->
    @if (isLoading) {
    <div class="loading-state">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">{{ 'editProfile.loading.text' | translate }}</span>
      </div>
      <p>{{ 'editProfile.loading.loadingData' | translate }}</p>
    </div>
    }

    <!-- Edit Profile Content -->
    @if (!isLoading && currentProfile) {
    <div class="profile-card">
      <!-- Profile Picture Section -->
      <div class="profile-picture-section">
        <div class="profile-picture-container">
          <img [src]="imagePreview || getProfilePictureUrl()" [alt]="'editProfile.profilePicture.alt' | translate" class="profile-picture">
          <label for="fileInput" class="upload-overlay">
            <i class="bi bi-camera-fill"></i>
          </label>
          <input type="file" id="fileInput" accept="image/*" (change)="onFileSelected($event)" class="d-none">
        </div>

        <!-- Upload Button -->
        @if (selectedFile && !uploadingImage) {
        <button type="button" class="btn-upload" (click)="uploadProfilePicture()">
          <i class="bi bi-upload"></i>
          {{ 'editProfile.profilePicture.uploadButton' | translate }}
        </button>
        }

        @if (uploadingImage) {
        <button type="button" class="btn-upload" disabled>
          <span class="spinner-border spinner-border-sm"></span>
          {{ 'editProfile.profilePicture.uploading' | translate }}
        </button>
        }
      </div>

      <!-- Profile Form -->
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
        <!-- Email (Read-only) -->
        <div class="form-group">
          <label class="form-label">{{ 'editProfile.form.email.label' | translate }}</label>
          <input type="email" class="form-input" [value]="currentProfile.email" readonly disabled>
        </div>

        <!-- First Name -->
        <div class="form-group">
          <label class="form-label">
            {{ 'editProfile.form.firstName.label' | translate }} <span class="required">{{ 'editProfile.form.required' | translate }}</span>
          </label>
          <input type="text" class="form-input" formControlName="firstName"
            (blur)="profileForm.get('firstName')?.markAsTouched()" [class.invalid]="isFieldInvalid('firstName')"
            [placeholder]="'editProfile.form.firstName.placeholder' | translate">
          @if (isFieldInvalid('firstName')) {
          <div class="error-message">
            {{ getFieldError('firstName') }}
          </div>
          }
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label class="form-label">
            {{ 'editProfile.form.lastName.label' | translate }} <span class="required">{{ 'editProfile.form.required' | translate }}</span>
          </label>
          <input type="text" class="form-input" formControlName="lastName"
            (blur)="profileForm.get('lastName')?.markAsTouched()" [class.invalid]="isFieldInvalid('lastName')"
            [placeholder]="'editProfile.form.lastName.placeholder' | translate">
          @if (isFieldInvalid('lastName')) {
          <div class="error-message">
            {{ getFieldError('lastName') }}
          </div>
          }
        </div>

        <!-- Phone Number -->
        <div class="form-group">
          <label class="form-label">
            {{ 'editProfile.form.phoneNumber.label' | translate }} <span class="required">{{ 'editProfile.form.required' | translate }}</span>
          </label>
          <input type="tel" class="form-input" formControlName="phoneNumber"
            (blur)="profileForm.get('phoneNumber')?.markAsTouched()" [class.invalid]="isFieldInvalid('phoneNumber')"
            [placeholder]="'editProfile.form.phoneNumber.placeholder' | translate">
          @if (isFieldInvalid('phoneNumber')) {
          <div class="error-message">
            {{ getFieldError('phoneNumber') }}
          </div>
          }
        </div>

        <!-- Member Since -->
        <div class="member-info">
          <i class="bi bi-calendar"></i>
          {{ 'editProfile.form.memberSince' | translate }} {{ currentProfile.createdAt | date: 'dd/MM/yyyy' }}
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button type="submit" class="btn-primary" [disabled]="!canSave">
            @if (isSubmitting) {
            <span class="spinner-border spinner-border-sm"></span>
            {{ 'editProfile.buttons.saving' | translate }}
            } @else {
            <i class="bi bi-check-circle"></i>
            {{ 'editProfile.buttons.save' | translate }}
            }
          </button>

          <button type="button" class="btn-secondary" routerLink="/home" [disabled]="isSubmitting">
            <i class="bi bi-x-circle"></i>
            {{ 'editProfile.buttons.cancel' | translate }}
          </button>

          <button type="button" class="btn-danger" (click)="deleteAccount()" [disabled]="isSubmitting">
            <i class="bi bi-trash"></i>
            {{ 'editProfile.buttons.deleteAccount' | translate }}
          </button>
        </div>
      </form>
    </div>
    }
  </div>
</div>
