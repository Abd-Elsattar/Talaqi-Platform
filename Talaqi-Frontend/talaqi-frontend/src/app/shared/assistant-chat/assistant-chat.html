<div class="assistant-widget" [class.open]="isOpen()">
  <!-- Floating Button -->
  <button class="assistant-fab" (click)="toggleOpen()" [disabled]="isSending()" [attr.aria-label]="'assistant.button.label' | translate">
    <span class="ai-icon">ğŸ¤–</span>
    <span class="pulse" [class.hidden]="isOpen()"></span>
  </button>

  <!-- Friendly hint bubble when closed -->
  <div class="assistant-hint" *ngIf="!isOpen() && showHint()">
    <div class="hint-bubble">
      <span>{{ 'assistant.hint.text' | translate }}</span>
      <button class="hint-close" (click)="showHint.set(false)" [attr.aria-label]="'assistant.hint.close' | translate">âœ•</button>
    </div>
  </div>

  <!-- Panel -->
  <div class="assistant-panel" *ngIf="isOpen()">
    <div class="panel-header">
      <div class="title">{{ 'assistant.panel.title' | translate }}</div>
      <button class="close" (click)="close()" [attr.aria-label]="'assistant.panel.close' | translate">âœ•</button>
    </div>

    <div #scrollArea class="messages" role="log" aria-live="polite">
      <div *ngFor="let m of messages()" class="msg" [class.user]="m.role==='user'"
        [class.assistant]="m.role==='assistant'" [class.error]="m.error">
        <div class="bubble">
          <span class="text">{{ m.text }}</span>
        </div>

        <!-- <div *ngIf="m.snippets?.length" class="sources">
          <details>
            <summary>{{ 'assistant.sources.title' | translate }}</summary>
            <div class="cards">
              <div *ngFor="let s of m.snippets" class="card" [title]="s.itemType">
                <div class="card-type">{{ s.itemType }}</div>
                <div class="card-snippet">{{ s.snippet }}</div>
                <div class="card-score">{{ 'assistant.sources.score' | translate }}: {{ s.score | number:'1.0-2' }}</div>
              </div>
            </div>
          </details>
        </div> -->
      </div>
    </div>

    <div class="composer">
      <input type="text" [disabled]="isSending()" [(ngModel)]="inputValue" [placeholder]="'assistant.composer.placeholder' | translate" />
      <button class="send" (click)="send()" [disabled]="isSending() || !(inputValue || '').trim()" [attr.aria-label]="'assistant.composer.send' | translate">
        <span *ngIf="!isSending()">{{ 'assistant.composer.send' | translate }}</span>
        <span *ngIf="isSending()" class="dots">
          <span></span><span></span><span></span>
        </span>
      </button>
    </div>
  </div>
</div>
