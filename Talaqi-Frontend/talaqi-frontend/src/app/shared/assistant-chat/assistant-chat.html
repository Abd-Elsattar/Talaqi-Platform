<div class="assistant-widget" [class.open]="isOpen()" dir="rtl">
  <!-- Floating Button -->
  <button class="assistant-fab" (click)="toggleOpen()" [disabled]="isSending()" aria-label="Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ">
    <span class="ai-icon">ðŸ¤–</span>
    <span class="pulse" [class.hidden]="isOpen()"></span>
  </button>

  <!-- Friendly Arabic hint bubble when closed -->
  <div class="assistant-hint" *ngIf="!isOpen() && showHint()" dir="rtl">
    <div class="hint-bubble">
      <span>Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡Ù‚Ø¯ ÙŠØ³Ø§Ø¹Ø¯Ùƒ âœ¨</span>
      <button class="hint-close" (click)="showHint.set(false)" aria-label="Ø¥Ø®ÙØ§Ø¡">âœ•</button>
    </div>
  </div>

  <!-- Panel -->
  <div class="assistant-panel" *ngIf="isOpen()">
    <div class="panel-header">
      <div class="title">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</div>
      <button class="close" (click)="close()" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
    </div>

    <div #scrollArea class="messages" role="log" aria-live="polite">
      <div *ngFor="let m of messages()" class="msg" [class.user]="m.role==='user'"
        [class.assistant]="m.role==='assistant'" [class.error]="m.error">
        <div class="bubble">
          <span class="text">{{ m.text }}</span>
        </div>

        <!-- <div *ngIf="m.snippets?.length" class="sources">
          <details>
            <summary>Ø§Ù„Ù…ØµØ§Ø¯Ø±</summary>
            <div class="cards">
              <div *ngFor="let s of m.snippets" class="card" title="{{ s.itemType }}">
                <div class="card-type">{{ s.itemType }}</div>
                <div class="card-snippet">{{ s.snippet }}</div>
                <div class="card-score">Ø§Ù„Ø¯Ø±Ø¬Ø©: {{ s.score | number:'1.0-2' }}</div>
              </div>
            </div>
          </details>
        </div> -->
      </div>
    </div>

    <div class="composer">
      <input type="text" [disabled]="isSending()" [(ngModel)]="inputValue" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." />
      <button class="send" (click)="send()" [disabled]="isSending() || !(inputValue || '').trim()" aria-label="Ø¥Ø±Ø³Ø§Ù„">
        <span *ngIf="!isSending()">Ø¥Ø±Ø³Ø§Ù„</span>
        <span *ngIf="isSending()" class="dots">
          <span></span><span></span><span></span>
        </span>
      </button>
    </div>
  </div>
</div>
