{
  "version": 3,
  "sources": ["src/app/core/services/token.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { User, AuthResponse } from '../models/auth';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class TokenService {\r\n    private readonly ACCESS_TOKEN_KEY = 'access_token';\r\n    private readonly REFRESH_TOKEN_KEY = 'refresh_token';\r\n    private readonly TOKEN_EXPIRES_AT_KEY = 'token_expires_at';\r\n    private readonly USER_KEY = 'user';\r\n\r\n    private currentUserSubject = new BehaviorSubject<User | null>(this.getStoredUser());\r\n    public currentUser$ = this.currentUserSubject.asObservable();\r\n\r\n    constructor() { }\r\n\r\n    getAccessToken(): string | null {\r\n        return localStorage.getItem(this.ACCESS_TOKEN_KEY);\r\n    }\r\n\r\n    getRefreshToken(): string | null {\r\n        return localStorage.getItem(this.REFRESH_TOKEN_KEY);\r\n    }\r\n\r\n    getTokenExpiresAt(): string | null {\r\n        return localStorage.getItem(this.TOKEN_EXPIRES_AT_KEY);\r\n    }\r\n\r\n    getStoredUser(): User | null {\r\n        const userJson = localStorage.getItem(this.USER_KEY);\r\n        return userJson ? JSON.parse(userJson) : null;\r\n    }\r\n\r\n    saveTokens(authResponse: AuthResponse): void {\r\n        localStorage.setItem(this.ACCESS_TOKEN_KEY, authResponse.accessToken);\r\n        localStorage.setItem(this.REFRESH_TOKEN_KEY, authResponse.refreshToken);\r\n        localStorage.setItem(this.TOKEN_EXPIRES_AT_KEY, authResponse.expiresAt);\r\n        localStorage.setItem(this.USER_KEY, JSON.stringify(authResponse.user));\r\n        this.currentUserSubject.next(authResponse.user);\r\n    }\r\n\r\n    clearTokens(): void {\r\n        localStorage.removeItem(this.ACCESS_TOKEN_KEY);\r\n        localStorage.removeItem(this.REFRESH_TOKEN_KEY);\r\n        localStorage.removeItem(this.TOKEN_EXPIRES_AT_KEY);\r\n        localStorage.removeItem(this.USER_KEY);\r\n        this.currentUserSubject.next(null);\r\n    }\r\n\r\n    isAuthenticated(): boolean {\r\n        const token = this.getAccessToken();\r\n        const expiresAt = this.getTokenExpiresAt();\r\n\r\n        if (!token || !expiresAt) {\r\n            return false;\r\n        }\r\n\r\n        // Check if token is expired\r\n        const expirationDate = new Date(expiresAt);\r\n        return expirationDate > new Date();\r\n    }\r\n\r\n    isTokenExpiringSoon(minutesBeforeExpiry: number = 5): boolean {\r\n        const expiresAt = this.getTokenExpiresAt();\r\n        if (!expiresAt) {\r\n            return false;\r\n        }\r\n\r\n        const expirationDate = new Date(expiresAt);\r\n        const now = new Date();\r\n        const timeUntilExpiry = expirationDate.getTime() - now.getTime();\r\n        const minutesUntilExpiry = timeUntilExpiry / (1000 * 60);\r\n\r\n        return minutesUntilExpiry <= minutesBeforeExpiry && minutesUntilExpiry > 0;\r\n    }\r\n\r\n    getCurrentUser(): User | null {\r\n        return this.currentUserSubject.value;\r\n    }\r\n\r\n    // Update current user data (e.g., after profile update)\r\n    updateUser(user: User): void {\r\n        localStorage.setItem(this.USER_KEY, JSON.stringify(user));\r\n        this.currentUserSubject.next(user);\r\n    }\r\n\r\n    isAdmin(): boolean {\r\n        const user = this.getCurrentUser();\r\n        return user?.role === 'Admin';\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;IAOa;;;;;AAPb;AACA;AAMO,IAAM,eAAN,MAAMA,cAAY;MACJ,mBAAmB;MACnB,oBAAoB;MACpB,uBAAuB;MACvB,WAAW;MAEpB,qBAAqB,IAAI,gBAA6B,KAAK,cAAa,CAAE;MAC3E,eAAe,KAAK,mBAAmB,aAAY;MAE1D,cAAA;MAAgB;MAEhB,iBAAc;AACV,eAAO,aAAa,QAAQ,KAAK,gBAAgB;MACrD;MAEA,kBAAe;AACX,eAAO,aAAa,QAAQ,KAAK,iBAAiB;MACtD;MAEA,oBAAiB;AACb,eAAO,aAAa,QAAQ,KAAK,oBAAoB;MACzD;MAEA,gBAAa;AACT,cAAM,WAAW,aAAa,QAAQ,KAAK,QAAQ;AACnD,eAAO,WAAW,KAAK,MAAM,QAAQ,IAAI;MAC7C;MAEA,WAAW,cAA0B;AACjC,qBAAa,QAAQ,KAAK,kBAAkB,aAAa,WAAW;AACpE,qBAAa,QAAQ,KAAK,mBAAmB,aAAa,YAAY;AACtE,qBAAa,QAAQ,KAAK,sBAAsB,aAAa,SAAS;AACtE,qBAAa,QAAQ,KAAK,UAAU,KAAK,UAAU,aAAa,IAAI,CAAC;AACrE,aAAK,mBAAmB,KAAK,aAAa,IAAI;MAClD;MAEA,cAAW;AACP,qBAAa,WAAW,KAAK,gBAAgB;AAC7C,qBAAa,WAAW,KAAK,iBAAiB;AAC9C,qBAAa,WAAW,KAAK,oBAAoB;AACjD,qBAAa,WAAW,KAAK,QAAQ;AACrC,aAAK,mBAAmB,KAAK,IAAI;MACrC;MAEA,kBAAe;AACX,cAAM,QAAQ,KAAK,eAAc;AACjC,cAAM,YAAY,KAAK,kBAAiB;AAExC,YAAI,CAAC,SAAS,CAAC,WAAW;AACtB,iBAAO;QACX;AAGA,cAAM,iBAAiB,IAAI,KAAK,SAAS;AACzC,eAAO,iBAAiB,oBAAI,KAAI;MACpC;MAEA,oBAAoB,sBAA8B,GAAC;AAC/C,cAAM,YAAY,KAAK,kBAAiB;AACxC,YAAI,CAAC,WAAW;AACZ,iBAAO;QACX;AAEA,cAAM,iBAAiB,IAAI,KAAK,SAAS;AACzC,cAAM,MAAM,oBAAI,KAAI;AACpB,cAAM,kBAAkB,eAAe,QAAO,IAAK,IAAI,QAAO;AAC9D,cAAM,qBAAqB,mBAAmB,MAAO;AAErD,eAAO,sBAAsB,uBAAuB,qBAAqB;MAC7E;MAEA,iBAAc;AACV,eAAO,KAAK,mBAAmB;MACnC;;MAGA,WAAW,MAAU;AACjB,qBAAa,QAAQ,KAAK,UAAU,KAAK,UAAU,IAAI,CAAC;AACxD,aAAK,mBAAmB,KAAK,IAAI;MACrC;MAEA,UAAO;AACH,cAAM,OAAO,KAAK,eAAc;AAChC,eAAO,MAAM,SAAS;MAC1B;;;AApFS,mBAAY,WAAA;MAHxB,WAAW;QACR,YAAY;OACf;OACY,YAAY;;;",
  "names": ["TokenService"]
}
